# TCP와 UDP

---

## 1. TCP (Transmission Control Protocol)

**연결 지향적**이며 **신뢰성 있는 전송**을 보장하기 위해 설계된 프로토콜. 여러 제어 메커니즘을 사용하여 데이터의 손실, 중복, 순서 오류 및 네트워크 혼잡을 효과적으로 관리한다.

### 1.1 연결 수립과 해제

#### 1.1.1 3 Way Handshake – 연결 수립

- **SYN**: 클라이언트는 초기 시퀀스 번호(예: x)를 포함한 SYN 패킷을 서버로 전송.
- **SYN-ACK**: 서버는 클라이언트의 SYN 패킷을 수신하고, 자신의 초기 시퀀스 번호(예: y)를 포함한 SYN-ACK 패킷을 클라이언트에 전송하며, 클라이언트의 시퀀스 번호 x에 대한 ACK(x+1)도 함께 보낸다.
- **ACK**: 클라이언트는 서버의 SYN-ACK 패킷을 받고, 서버의 시퀀스 번호에 대한 ACK(y+1)를 전송함으로써 연결을 수립함.

#### 1.1.2 4 Way Handshake – 연결 해제

- **FIN 전송**: 연결을 종료하고자 하는 측(예: 클라이언트)이 FIN 패킷을 보내 종료 의사를 알림.
- **ACK 응답**: 상대 측(서버)은 FIN 패킷에 대해 ACK를 전송하며, 이 시점부터 자신의 연결 종료 준비를 시작한다.
- **서버의 FIN 전송**: 서버가 모든 데이터를 전송한 후 FIN 패킷을 보내 연결 종료를 요청한다.
- **클라이언트의 ACK 응답**: 클라이언트는 서버의 FIN에 대해 ACK를 전송하고, 일정 기간(TIME_WAIT)을 유지한 후 연결을 완전히 종료함.

### 1.2 신뢰성 및 데이터 무결성

- **시퀀스 번호와 ACK**: 각 세그먼트에는 시퀀스 번호가 부여되며, 수신 측은 해당 데이터를 올바른 순서로 재조립하기 위해 ACK(확인 응답)를 전송한다. ACK가 누락되면 타이머 기반 재전송이 이루어짐.
- **오류 검출**: 체크섬 필드를 이용하여 데이터 전송 중 발생할 수 있는 오류를 검출한다.
- **중복 패킷 제거 및 순서 보장**: 수신 측은 시퀀스 번호를 기반으로 중복 패킷을 제거하고, 데이터가 올바른 순서로 배열되도록 처리한다.

### 1.3 흐름 제어 (Flow Control)

TCP는 **슬라이딩 윈도우** 프로토콜을 사용하여 송신 측이 수신 측의 버퍼 용량을 초과하지 않도록 제어한다.

- **윈도우 크기 (Window Size)**: 수신 측은 자신의 현재 버퍼 여유분을 윈도우 크기로 송신 측에 알린다.
- **윈도우 이동**: 송신 측은 `LastByteSent – LastByteAcked` 값이 수신자가 알린 윈도우 크기를 초과하지 않도록 데이터를 전송한다. 데이터에 대해 성공적으로 ACK를 받으면 윈도우가 오른쪽으로 이동하며, 새로운 데이터를 전송할 수 있게 된다.
- **실시간 피드백**: 수신 측의 버퍼 상태가 변경되면 즉시 윈도우 크기를 업데이트하여 송신 측이 이를 반영하도록 한다.

### 1.4 혼잡 제어 (Congestion Control)

- **AIMD (Additive Increase/Multiplicative Decrease)**:
  - 데이터가 원활히 전달되면 윈도우 크기를 점진적으로 증가시킨다.
  - 패킷 손실이나 중복 ACK가 발생하면 윈도우 크기를 급격히 줄여 네트워크 혼잡을 완화한다.
- **Slow Start**:
  - 연결 초기에는 윈도우 크기를 지수 함수 형태로 빠르게 증가시켜 네트워크의 용량을 탐색한다.
  - 혼잡 징후가 감지되면 전환 임계점(Congestion Window Threshold) 이후에는 선형적으로 증가시킨다.
- **Fast Retransmit & Fast Recovery**:
  - 중복 ACK가 3회 이상 수신되면 손실된 세그먼트를 즉시 재전송한다.
  - 재전송 후 혼잡 윈도우를 조정함.

### 1.5 TCP 헤더 구조

- **Source Port & Destination Port**: 송신 및 수신 애플리케이션의 포트 번호.
- **Sequence Number & Acknowledgment Number**: 데이터 순서 제어 및 확인에 사용.
- **Data Offset**: 헤더의 길이(옵션 필드 포함).
- **Flags**: SYN, ACK, FIN, RST, URG, PSH 등의 제어 비트.
- **Window Size**: 수신 측의 버퍼 여유분을 나타내는 값.
- **Checksum**: 헤더와 데이터의 무결성을 검증.
- **Urgent Pointer & 옵션 필드**: 긴급 데이터와 추가 제어 정보 제공.

---

## 2. UDP (User Datagram Protocol)

UDP는 **비연결형** 프로토콜로, 최소한의 오버헤드와 빠른 전송 속도가 요구되는 환경에서 사용된다.

### 2.1 기본 특징

- **비연결형 통신**:  
  UDP는 연결 수립 과정을 거치지 않고 데이터그램 단위로 독립적으로 전송한다. 이로 인해 초기 지연(latency)이 거의 없으며, 실시간 응용에 유리함.
- **간단한 헤더 구조**:

  - **Source Port & Destination Port**: 각각 16bit로 송신 및 수신 애플리케이션의 포트 번호.
  - **Length**: 헤더와 데이터의 총 길이.
  - **Checksum**: 전송 중 오류 검출을 위한 값.

- **신뢰성 미보장**:  
  UDP는 재전송, 순서 제어, 흐름 제어나 혼잡 제어 기능이 없다. 따라서 데이터 손실, 중복, 순서 뒤바뀜 등의 문제가 발생할 수 있으며, 이러한 처리는 애플리케이션 계층에서 별도로 구현해야 한다.

### 2.2 주요 사용 사례

- **DNS 쿼리**: 요청과 응답 데이터가 작고, 3-way 핸드쉐이크의 오버헤드를 피하기 위해 주로 UDP를 사용합니다. (단, 데이터 크기가 제한을 초과하는 경우 TCP를 사용)

### 2.3 UDP 헤더의 단순성

- **낮은 오버헤드**: 데이터 전송 시 TCP와 달리 복잡한 연결 설정이나 관리 과정이 없으므로 빠른 처리와 낮은 지연을 실현합니다.
- **빠른 데이터 처리**: 실시간 애플리케이션이나 방송 서비스 등에서는 빠른 패킷 처리와 전송이 요구되므로 UDP가 적합하다.

---

## 3. TCP와 UDP의 상세 비교

| **특성**           | **TCP**                                                                      | **UDP**                                                                 |
| ------------------ | ---------------------------------------------------------------------------- | ----------------------------------------------------------------------- |
| **연결 방식**      | 연결 지향적 – 3 Way Handshake와 4 Way Handshake를 통한 연결 성립 및 종료     | 비연결형 – 별도의 연결 수립 없이 독립적으로 데이터그램 전송             |
| **신뢰성**         | 재전송, 순서 제어, 중복 제거, 체크섬 등을 통한 신뢰성 보장                   | 신뢰성 미보장 – 체크섬에 의한 오류 검출만 제공 (재전송, 순서 보장 없음) |
| **헤더 크기**      | 20바이트 이상 (옵션 포함 시 더 커질 수 있음)                                 | 8바이트 (간단하고 경량화된 구조)                                        |
| **오버헤드**       | 연결 설정, 흐름 및 혼잡 제어 등으로 인한 높은 오버헤드                       | 최소한의 오버헤드로 빠른 전송 가능                                      |
| **흐름/혼잡 제어** | 슬라이딩 윈도우, AIMD, Slow Start, Fast Retransmit/Recovery 등으로 동적 제어 | 제공되지 않음 – 애플리케이션에서 별도 처리 필요                         |
| **전송 방식**      | 바이트 스트림 – 연속적인 데이터 흐름 처리                                    | 데이터그램 – 독립적인 패킷 단위로 전송                                  |

---
